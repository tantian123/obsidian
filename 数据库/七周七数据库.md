 PostgreSQL、 Apache HBase、 MongoDB、 Apache CouchDB、 Neo4J、 DynamoDB 和 Redis

对于每个数据库，每个数据库背后的基本概念，解决一个真实世界的问题，突出概念和特性。
在此过程中，探索五种数据库模型——关系模型、键/值模型、柱状模型、文档模型和图形模型。了解 MongoDB 和 CouchDB 是如何显著不同的，使用 Redis 使您的应用程序更快，并与 Neo4J 更紧密地连接，使用云服务(如 Amazon 的 Elastic MapReduce)构建一个 HBase 服务器集群，等等。




从基本的 CRUD 操作到细粒度的模式设计，再到在遥远的数据中心运行分布式系统，所有这些都是为了找到这些问题的答案:
这是什么类型的数据库？数据库有多种类型，比如关系数据库、键值数据库、柱状数据库、面向文档的数据库和图形数据库。流行的数据库

动力是什么？数据库不是在真空中创建的。它们被设计用来解决实际用例中出现的问题。RDBMS 数据库产生于一个查询灵活性比灵活模式更重要的世界。另一方面，面向列的数据库非常适合在多台机器上存储大量数据，而数据关系则处于次要地位。我们将介绍每个数据库的用例以及相关的示例。


它有什么特别之处？任何数据库都支持写入数据并再次读出数据。它的其他功能在不同的数据库之间差异很大。有些允许对任意字段进行查询。有些提供了用于快速查找的索引。一些支持临时查询，而另一些则必须计划查询。数据模式是由数据库强制执行的严格框架，还是仅仅是一套随意重新协商的指导方针？理解功能和约束将帮助您为作业选择正确的数据库。

它表现如何？这个数据库是如何工作的，成本是多少？它支持分片吗？那复制呢？它是使用一致哈希平均分配数据，还是像数据一样保存在一起？这个数据库是否针对读、写或其他操作进行了调优？如果有的话，你对它的调谐有多少控制权？

它是如何扩展的？可伸缩性与性能有关。谈论可伸缩性而不考虑您想要伸缩到什么上下文通常是徒劳的。这本书将为你提供你需要的背景知识，让你提出正确的问题来建立这样的背景。虽然关于如何扩展每个数据库的讨论有意轻描淡写，但是在这些页面中，你会发现每个数据库是否更适合于水平扩展(MongoDB、 HBase、 DynamoDB)、传统的垂直扩展(Postgres、 Neo4J、 Redis) ，或者介于两者之间。



pg
RDBMS 建立在一个称为关系代数的集合理论分支之上ーー选择(WHERE...)、投影(SELECT...)、笛卡尔积(JOIN...)等等的组合

JSON 类型以文本形式存储 JSON，而 jsonb 使用分解的二进制格式存储 JSON

### PostgreSQL 的优势
1. **灵活查询**：能够执行复杂的连接、过滤、视图和索引，提供了巨大的查询灵活性。
2. **数据一致性和持久性**：通过强大的事务支持和持久性保证，确保数据完整性。
3. **广泛的语言支持**：大多数编程语言都有经过充分测试的驱动程序，并且可以无缝集成到各种编程范式中。
4. **模式灵活性**：除了标准的 RDBMS 功能外，PostgreSQL 还支持高级模式约束、自定义数据类型
### PostgreSQL 的弱点

1. **分区挑战**：尽管 PostgreSQL 在集群能力方面有所改进，但在水平扩展（跨多台机器）方面仍然可能比某些 NoSQL 数据库更具挑战性。
2. **非结构化数据处理**：虽然 PostgreSQL 支持 JSON 和 JSONB 用于处理半结构化数据，但它可能不如专门为非结构化数据设计的专用 NoSQL 数据库高效或可扩展。
3. **使用场景限制**：
    - **缓存需求**：对于简单的缓存需求，轻量级解决方案如 Redis 可能更合适。
    - **高吞吐量键值存储**：如果应用程序需要极高的键值对读写吞吐量，专用的键值存储可能是更好的选择。
    - **大型 BLOB 存储**：对于存储大型二进制对象，其他解决方案可能提供更好的性能和效率。


### 为什么NoSQL比RDBMS更适合“横向扩展”？
NoSQL的真正优势在于水平扩展，也称为分片
RDBMS需要关联，NoSQL不需要与其他表中的数据进行连接


### 使用 HBase 的理由
HBase 拥有一些其他数据库缺乏的内置功能，如版本控制、压缩、过期数据的垃圾回收以及内存表
HBase 还提供了强一致性保证，使某些用例从关系型数据库过渡变得更容易。最后，HBase 在行级别保证原子性，这意味着在 HBase 数据模型的关键层次上，你可以获得强一致性保证。
。对于真正的大查询，HBase 通常比其他数据库更快，这也解释了为什么 HBase 经常被大公司用于支持重型日志和搜索系统。

特点：
HBase 是一个**面向列**的数据库，以其能够**同时提供一致性和可扩展性**而自豪
HBase 可以优雅地从单个服务器故障中恢复，因为它采用了预写日志（write-ahead logging），即在数据写入磁盘之前先写入内存日志，这样节点可以使用日志进行恢复而不是直接从磁盘读取。此外，HBase 采用分布式配置，节点可以相互依赖配置信息，而不是依赖于集中式的配置源。

**HBase只是一个NoSQL数据库，把数据存在HDFS上**
HBase在HDFS之上提供了**高并发的随机写和支持实时查询**，这是HDFS不具备的
HBase还有一个特点就是：**存储数据的”结构“可以地非常灵活**


表 (Table) 表是 HBase 中数据的逻辑容器。每个表由多个行组成
行键是表中每一行的唯一标识符 类似主键 起到了将多个物理上分离的数据项逻辑上关联起来的作用
尽管 列族的数据物理上是分开存储的，但它们通过相同的行键逻辑上关联在一起。

列族是一组列的集合，具有相同的前缀。列族是 HBase 中存储和管理数据的基本单位
列是列族中的具体数据项，由列族名和列限定符组成，格式为 `column_family:column_qualifier`


HBase 的一个值得注意的特点是，除了行键外，它不提供任何排序或索引功能。行按其行键保持排序，但不会对任何其他字段进行排序，比如列名和值。所以，如果您想根据键以外的东西查找行，您需要扫描表或者自己维护索引（可能是在另一个 HBase 表中或外部系统中）。
另一个缺失的概念是数据类型。HBase 中的所有字段值都被视为未经解释的字节数组。没有区分整数值、字符串和日期的区别。它们对 HBase 来说都是字节，因此您的应用程序负责解释字节，这可能很棘手，特别是如果您习惯于像对象关系映射器（ORMs）这样的关系访问模式。


关于 CAP，HBase 明显偏向 CP




Mongo 是一个 JSON 文档数据库(尽管技术上数据以二进制形式存储，称为 BSON)。Mongo 文档可以比作没有模式的关系表行，其值可以嵌套到任意深度
在某些方面，与关系数据库相比，文档数据库具有相反的工作流。像 PostgreSQL 这样的关系数据库假设您知道希望存储什么数据，而不一定知道如何使用它; 重要的是如何存储它。查询灵活性的代价是在存储上预先支付的。文档数据库要求您对希望如何使用数据做出一些假设，但是对希望存储的具体内容几乎没有假设。您可以动态地进行基本的“模式”更改


因为 Mongo 是无模式的，所以不需要事先定义任何东西; 仅仅使用它就足够了
与 PostgreSQL 一样，在 Mongo 中可以基于字段值、范围或条件组合构造即席查询。要查找以字母 P 开头、人口小于10,000的所有城镇，可以使用与 Perl 兼容的正则表达式(PCRE)[28]和范围运算符

但是 Mongo 的真正强大之处在于它能够深入挖掘文档并返回深度嵌套的子文档的结果。要查询子文档，字段名是用点分隔嵌套层的字符串

在 MongoDB 中有很多操作符

正如我们前面提到的，构建 Mongo 不是为了执行连接。由于其分布式特性，在 Mongo 中连接将是非常低效的操作。尽管如此，文档之间相互引用有时还是很有用的


我们看到了如何将嵌套的结构化数据存储为 JSON 对象并查询到任何深度。你了解到一个文档可以被想象成关系模型中一个无模式的行，由生成的 id 键控。一组文档在 Mongo 中称为集合，类似于 PostgreSQL 中的表，但也有很大不同。

与我们以前遇到的样式不同，Mongo 存储复杂的、非规范化的文档，并作为任意 JSON 结构的集合进行存储和检索。Mongo 使用了一种强大的查询机制，不受任何预定义模式的约束，从而实现了这种灵活的存储策略。


 Mongo 如何通过副本集增强数据持久性，以及如何通过分片支持水平伸缩

#### MongoDB 的优势

MongoDB 的主要优势在于它通过复制和水平扩展来处理海量数据（和海量请求）的能力。但它还具有非常灵活的数据模型的优势。您不需要遵循任何模式，可以简单地嵌套通常在关系型数据库管理系统（RDBMS）中使用 SQL 连接的任何值。

最后，MongoDB 被设计得易于使用。您可能已经注意到了 MongoDB 命令与 SQL 数据库概念之间的相似性（不包括服务器端连接）。这不是偶然的，这也是 MongoDB 在那些从关系数据库阵营叛逃的人群中获得广泛认知的一个原因。它足够不同，可以满足很多开发者的“痒点”，但又不至于变得奇怪和可怕。

#### MongoDB 的弱点

MongoDB 鼓励模式的非规范化（通过不定义任何模式），这对一些人来说可能难以接受。一些开发者发现关系型数据库中的严格约束令人放心。随意向任何集合中插入任何类型的值可能会带来危险。一个简单的拼写错误就可能导致数小时的头痛，如果您没有想到字段名和集合名可能是罪魁祸首的话。如果您的数据模型已经相当成熟并且锁定，MongoDB 的灵活性通常不是很重要。

由于 MongoDB 关注的是大型数据集，它在大型集群中表现最佳，这可能需要一些设计和管理上的努力。与一些新增节点透明且相对无痛的集群数据库不同，设置 MongoDB 集群需要更多的预先考虑。


CouchDB 是典型的基于 JSON 和 REST 的面向文档的数据库


您已经看到，数据库存储数据的方式主要可以分为五种类型: 关系型、键值型、柱型、文档型和图形型。让我们花点时间回顾一下它们之间的差异，看看每种风格适合什么，不适合什么ーー什么时候你想使用它们，什么时候避免使用它们。

关系

这是最常见的经典数据库模式。关系数据库管理系统(rDBMS)是以集合论为基础的系统，实施为具有行和列的二维表格。关系数据库严格执行类型，通常是数字、字符串、日期和未解释的 blobs，但正如您看到的，PostgreSQL 提供了数组或多维数据集等扩展。

好处:

由于关系数据库的结构化特性，当事先知道数据的布局，但是以后计划如何使用该数据可能并不知道时，它们是有意义的。或者，换句话说，您预先支付了组织的复杂性，以便在以后实现查询灵活性。从订单到发货，从库存到购物车，许多业务问题都以这种方式得到了恰当的建模。您可能事先不知道以后要如何查询这些数据ーー我们在2月份处理了多少订单? ーー但这些数据本质上是相当规律的，因此强制执行这种规律性是有帮助的。

不太好:

当数据具有高度可变性或高度层次化时，关系数据库不是最佳选择。因为您必须事先指定一个模式，所以显示高度记录到记录变化的数据问题将成为问题。考虑开发一个描述自然界所有生物的数据库。创建要考虑的所有特性的完整列表(hasHair、 numLegs、 laysEggs 等等)是很难的。在这种情况下，您可能希望数据库对您可以向其中输入的内容提前设置较少的限制。

键值

键值(KV)存储是我们介绍的最简单的模型。KV 映射简单键ーー有时映射到字符串等简单值，有时映射到更复杂的值，如大型散列表。由于它们相对简单，这种类型的数据库具有最大的实现灵活性。散列查找是快速的，所以在 Redis 的情况下，速度是它主要关心的问题。散列查找也很容易分布，所以 DynamoDB 在其分区方案中利用了这一点。当然，对于任何具有严格或复杂建模需求的数据来说，它的简单性可能是一个缺点。

好处:

由于几乎不需要或根本不需要维护索引，键值存储通常被设计成水平可伸缩的、极快的，或者两者兼而有之。它们特别适合于那些数据不是高度相关的问题。例如，在 Web 应用程序中，用户的会话数据符合这个标准; 每个用户的会话活动将是不同的，并且与其他用户的活动基本上无关。

不太好:

通常缺乏索引和扫描功能，如果需要对数据执行查询，除了基本的 CRUD 操作(创建、读取、更新、删除)之外，KV 存储不会帮助您。

柱状

Columnar 数据库(又名面向列或列族)与 KV 和 RDBMS 存储有许多相似之处。与键-值数据库一样，通过匹配键查询值。与关系类似，它们的值是由零个或多个列组成的组，尽管每一行可以填充它想要填充的任何数量。与这两者不同，柱状数据库按列存储类似数据的内容，而不是按行保存数据。添加列的成本很低，版本控制很简单，而且对于未填充的值没有实际的存储成本。您已经看到 HBase 是这种类型的经典实现。

好处:

传统上，柱状数据库是以水平可伸缩性作为主要设计目标来开发的。因此，它们特别适合于处理“大数据”问题，这些问题存在于数十个、数百个或数千个节点的集群中。它们还倾向于对诸如压缩和版本控制之类的特性提供内置支持。一个好的柱状数据存储问题的典型例子是索引 Web 页面。Web 上的页面是高度文本化的(这意味着它们受益于压缩) ，它们往往有些相互关联，并且随着时间的推移而变化(这意味着它们受益于版本控制)。

不太好:

不同的柱状数据库有不同的特点，因此有不同的缺点。但是它们有一个共同点，那就是最好根据计划查询数据的方式来设计模式。这意味着您应该提前知道数据将如何使用，而不仅仅是它将由什么组成。如果不能预先定义数据使用模式(例如，快速即席报告) ，那么柱状数据库可能不是最佳选择。

文件

文档数据库允许每个对象有任意数量的字段，甚至允许对象作为其他字段的值嵌套到任意深度。这些对象的通常表示形式是 JSON (JSON) ，MongoDB 和 CouchDB 都遵循这种表示形式ーー尽管这绝不是概念上的要求。因为文档不像关系数据库那样相互关联，所以它们相对容易在多个服务器之间进行分片和复制，这使得分布式实现相当普遍。MongoHQ 倾向于通过支持创建数据中心来处理可用性问题，这些数据中心管理着大量的网络数据集。同时，CouchDB 注重简单和持久性，其可用性是通过对相当自治的节点进行主-主复制来实现的。这些项目之间有很大的重叠。

好处:

文档数据库适合于涉及高度可变域的问题。当您事先不知道您的数据究竟是什么样子时，文档数据库是一个很好的选择。此外，由于文档的性质，它们通常很好地映射到面向对象程序设计模型。这意味着在数据库模型和应用程序模型之间移动数据时，阻抗不匹配较小。

不太好:

如果您习惯于在高度规范化的关系数据库模式上执行复杂的连接查询，您会发现文档数据库缺乏这种功能。文件一般应包含正常使用所需的大部分或全部相关信息。因此，尽管在关系数据库中，你会自然而然地对数据进行规范化，以减少或消除可能失去同步的副本，但在文档数据库中，反规范化的数据是常态。

图表

图形数据库是一种新兴的数据库类型，它更关注数据节点之间的相互关系，而不是存储在这些节点中的实际值。我们的开源示例 Neo4j 在许多社交网络应用程序中越来越受欢迎。与其他将相似对象的集合分组到公共桶中的数据库样式不同，图形数据库的形式更为自由ーー查询由两个节点共享的下列边组成，或者称为遍历节点。随着越来越多的项目使用它们，图形数据库越来越多地使用直接的社会示例，以占据更多细微差别的用例，如推荐引擎、访问控制列表和地理数据。

好处:

图形数据库似乎是为网络应用程序量身定制的。原型示例是一个社交网络，其中节点表示彼此之间有各种关系的用户。使用任何其他样式对这类数据进行建模通常都很困难，但是图形数据库会津津有味地接受它。它们也是面向对象系统的完美匹配。如果可以在白板上对数据进行建模，那么就可以用图表对其进行建模。

不太好:

由于节点之间的高度连通性，图形数据库一般不适合网络划分。快速遍历图表意味着无法承受到其他数据库节点的网络跳转，因此图表数据库不能很好地扩展。如果您使用图形数据库，它很可能是一个更大系统的一部分，大部分数据存储在其他地方，只有图形中维护的关系。