

输入sql ，sql解析器解析优化为sql执行计划并交给存储引擎处理。

存储引擎对数据库的内存或者磁盘中的数据进行读取和写入

一切的读取和写入都是通过bufferpool（在内存中缓存区）进行的
当进行写入时，存储引擎例如innodb会将数据插入到bufferPool中，同时将旧值记录到undo文件中

之后，innodb会启动线程 通过调用操作系统提供的open+write函数 写入到磁盘文件中

如果mysql挂掉了 在bufferpool中的数据会丢失，所以就有redo log buffer（也在内存中）。
这部分数据会刷到redo log中 
当mysql重启后，会将redo日志中的数据进行恢复

innodb在读取或者写入数据时，是通过页这个单位进行传递即 buffer pool中的单位是 页

binlog和这些步骤没有直接关系，
提供变更查询 数据库备份和恢复 主从复制等功能



### 保管数据
磁盘和内存

创建一个新表 innodb会在磁盘的data目录下 创建对应这个表的两个文件 
.frm   .ibd   第一个存储表结构（8之后的版本就没了）  第二个就叫表空间tablespace，用于存储表数据和索引 

在ibd文件中，最重要的结构体就是页 就是innodb的内存和磁盘交互的最小存储单元（内存和磁盘交互 至少读取一个页 固定16kb 页内物理地址是连续的 对应b+树的节点）
页有很多种类，例如索引页 包含页头 页尾 多个数据行
行是一个最大为8kb但是大小不固定的结构


如果读取的数据过大 跨页读取，那么多个页之间的物理距离过大，磁盘读取的磁头要进行上下移动，这种移动更耗费时间 （相比较磁片的旋转）


所以就有了区这个结构
区固定1MB 存放64个地址连续的页 这样就能大概率避免磁头移动 
新建表的时候，默认只会创建6个页 而不是一个完整的区 避免浪费空间

随着区的增多 又有了区组这个概念
每个区组管理256个区 即256MB

段 是一个逻辑概念
并不对应连续的物理空间 可以看做是区的标记信息（类似籍贯 便于管理）
页构成的段是非叶子节点段 区构成的段是叶子节点段，
非叶子节点段对应B+树中的非叶子节点 ，叶子节点段对应B+树中的叶子节点



### 一次查询过程
sql发送到存储引擎
在查询缓存中查询，查询缓存是一个map，key是sql语句 value是结果，默认关闭，8.0版本没有了，因为增加了查询消耗

通过sql解析器 进行词法分析  语法分析 语法验证
通过预处理器中 进行预处理 
通过sql优化器 选择成本最小的路径来作为执行计划
通过执行器，调用存储引擎的api 进行组合和调用


## 索引
