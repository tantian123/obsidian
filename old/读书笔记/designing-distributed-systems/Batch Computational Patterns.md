前一章描述了可靠、**长时间运行的服务器应用程序的模式** 本节描述批处理

与长时间运行的应用程序不同，批处理预计只运行很短的时间。批处理过程的例子包括生成用户遥测数据的聚合，分析每日或每周报告的销售数据，或转码视频文件。批处理拥有属性通常需要使用并行方式快速处理大量数据，以加快处理速度。分布式批处理最著名的模式是 MapReduce 模式

#### 工作队列
批处理的最简单形式是工作队列。在工作队列系统中，有一批工作要执行。每件作品都是完全独立的，可以在没有任何交互作用的情况下进行处理

工作队列源接口
工作队列源API是一个通用的接口，可以用于不同的场景，如云存储、网络存储或Kafka等
HTTP RESTful API是一种易于实现且被广泛接受的标准接口。

工作队列管理器
一旦工作队列管理器获得了特定的工作项，就需要工作人员对其进行处理。这是通用工作队列中的第二个容器接口。由于以下几个原因

利用Kubernetes的容器调度器实现可靠的工作队列

#### 事件驱动的处理系统
这种类型的系统最直接的应用程序只是将一个队列的输出链接到下一个队列的输入

复制器
复制器的工作是获取单个工作项流，并将其复制到两个或更多相同的流中

过滤器
筛选器的作用是通过筛选出不符合特定条件的工作项，将工作项流减少为较小的工作项流

拆分器
希望在工作项集合中存在两种不同的输入，并且希望将它们分成两个独立的工作队列，而不删除其中任何一个

分片器
根据某种分片功能将单个队列分割成均匀分割的工作项集合
更均匀地将工作分布在不同的资源上

合并器
是复制器的相反 合并的工作是将两个不同的工作队列转换为单个工作队列



新用户注册构建事件驱动的流：
第一个是用户验证。新用户注册后，用户必须接收电子邮件通知来验证他们的电子邮件。一旦用户验证了他们的电子邮件，他们就会收到一封确认邮件。然后，它们可以选择注册为电子邮件、短信，或者两者都注册，或者都不注册为通知。

事件驱动工作流的第一步是生成验证电子邮件。为了可靠地实现这一点，我们将使用分片模式跨多个不同的地理故障区域对用户进行分片。这确保了我们将继续处理新的用户注册，即使存在部分故障。每个工作队列碎片向最终用户发送一封验证电子邮件


当我们收到来自最终用户的验证电子邮件时，工作流再次开始。这些电子邮件成为一个单独的(但明显相关的)工作流中的新事件，该工作流发送欢迎电子邮件并设置通知。此工作流的第一个阶段是复印机模式的示例，其中将用户复制到两个工作队列中。第一个工作队列负责发送欢迎电子邮件，第二个工作队列负责设置用户通知。

构建这样的工作流的流行方法是使用发布者/订阅者(发布者/订阅者) API 或服务。Pub/sub API 允许用户定义一组队列(有时称为主题)。一个或多个发布者将消息发布到这些队列。同样，一个或多个订阅者正在监听这些队列以获取新消息。发布消息时，消息由队列可靠地存储，随后以可靠的方式传递给订阅方



Helm 是 Kubernetes 的一个包管理器，它使得部署和管理预先打包的、现成的应用程序(如 Kafka)变得非常容易


#### 协作批处理
