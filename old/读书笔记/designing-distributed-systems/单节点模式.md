

边车模式sidecar
边车模式是由两个容器组成的单节点模式。第一个是应用程序容器。它包含应用程序的核心逻辑。没有这个容器，应用程序就不会存在。除了应用程序容器之外，还有一个边车容器。
边车容器通过一个原子容器组(如 Kubernetes 的 pod API 对象)共同安排到同一台机器上。除了在同一台计算机上调度之外，应用程序容器和边车容器还共享许多资源

当更改应用程序代价太高时，可以使用 Sidecars 更新现有的遗留应用程序。同样，它们可以用来创建模块化的实用容器，从而标准化通用功能的实现
例如使用ng将系统由http改为https 

Sidecar 容器与主应用程序容器共享一个文件系统，并运行一个简单的循环，将文件系统与现有的 Git 存储库同步

边车是可重用的

参数化容器 实现模块化的、可重用的容器
将容器看做一个函数

dockerfile记录了容器的工作方式 最好加上每行的注释
![[Pasted image 20231206203330.png]]
![[Pasted image 20231206203402.png]]
![[Pasted image 20231206203354.png]]

### 总结
边车模式 两个容器 
两个作用：附加功能，模块化重用
技巧：参数化容器 api公开 多写注释



=======================
大使模式ambassador pattern

存储的数据过多 单台机器无法处理 此时需要数据分片
该模式用于调整现有服务，使其与世界上某个地方存在的分片服务进行通信。

![[Pasted image 20231206203428.png]]


引入一个大使容器，该容器包含将请求路由到适当存储分片所需的所有逻辑
此时将关注点分离 业务不需要关注存储分片的具体实现 
应用程序容器只知道它需要与存储服务对话并在 localhost 上发现该服务
这种大使模式也能实现重用


实践：实现一个分片的redis
我们首先将一个分片 Redis 服务部署到 Kubernetes 集群。我们将使用状态集 API 对象来部署它
```
apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  name: sharded-redis
spec:
  serviceName: "redis"
  replicas: 3
  template:
    metadata:
      labels:
        app: redis
    spec:
      terminationGracePeriodSeconds: 10
      containers:
      - name: redis
        image: redis
        ports:
        - containerPort: 6379
          name: redis
```
Twemxy 是 memcached 和 Redis 的一个轻量级、高性能的代理，它最初是由 Twitter 开发的

当尝试在多个环境(例如公共云、物理数据中心或私有云)中呈现可移植的应用程序时，主要的挑战之一是服务发现和配置



============


侧卡模式如何扩展和增强现有的应用程序容器。我们还了解了大使如何更改和代理应用程序容器与外部世界的通信方式。本章描述了最终的单节点模式: 适配器模式


例如你要使用 Prometheus监控器  它收集指标并将它们聚合到一个单一的时间序列数据库中
Prometheus 希望每个容器都公开一个特定的 API
许多流行的程序，例如 Redis 键值存储 并没有这个API

在考虑适配器模式时经常出现的一个问题是: 为什么不简单地修改应用程序容器本身？如果您是负责应用程序容器的开发人员，那么这实际上可能是一个好的解决方案。调整代码或容器以实现一致的接口可以很好地工作。但是，在许多情况下，我们是在重用别人的容器 使用适配器可以不修改