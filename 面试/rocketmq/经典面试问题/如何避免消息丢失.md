从消息传递的三个阶段分析：send ack
1.生产阶段 从生产者到broker 
生产者处理broker的响应 失败则重发

2.存储阶段 broker中消息的存储
Broker 需要控制响应的时机，默认是先保存在内存中立即返回响应 再批量异步刷盘
若想保证 Broker 端不丢消息，保证消息的可靠性，我们需要将消息保存机制修改为**同步刷盘**方式
在集群下，还需要保证存入从节点，此时需要配置主节点采用同步配置，只有从节点复制完成，才会返回确认响应
总结下，
单机情况下是消息刷盘后返回响应，集群多副本情况下，即发送至两个副本及以上的情况下再返回响应。（当某个broker宕机时 其他的broker可以代替宕机的broker 保证消息不丢）

3.消费阶段 消费者从broker拉取消息 pull ack
消费者 需要在执行完真正的业务逻辑之后再返回响应给 Broker


4.总结 
通过确认机制  配置刷盘和复制的策略 保证消息不丢失