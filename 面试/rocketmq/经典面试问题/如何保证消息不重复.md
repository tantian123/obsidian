### 重复的场景
发送重复
ack丢失或者生产者宕机
生产者会重复发送两条相同的消息

消费时重复
ack丢失或者消费者宕机
broker会重复发送

负载均衡时重复
Broker或客户端重启、扩容或缩容时，会触发Rebalance，此时消费者可能会收到重复消息

### 处理重复
最简单的是把业务设计为幂等的，这个适用场景不多

1.使用数据库的唯一约束实现幂等
将消息id作为唯一索引
如果是mysql就是INSERT IF NOT EXIST
如果是redis就是setnx

但是如果存在分库分表 会有问题吗？
2.消息中附带信息 利用类似版本号的操作 一致就加一 不一致就不处理
3.记录操作的唯一id，消费前先检查是否消费过